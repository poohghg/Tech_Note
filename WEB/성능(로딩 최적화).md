원격 서버에 있는 자원을 컴퓨터에 다운로드해서 웹 문서로 보여주는 것이 브라우저의 역할이다.
- HTTP 통신을 제어하냐에 따라 웹페이지의 성능을 크게 좌우 할 수 있다.

### 렌더링 과정

- DNS(Domain Name System) Lookup: 도메인 주소를 IP 주소로 변환한다.
- HTML 문서 획득: 클라이언트는 서버에 요청을 보내 HTML 문서를 응답 받는다.
- 주요 렌더링 경로(Critical Rendering Path, CRP): 브라우저가 HTML 문서를 받아 화면에 표시하기까지의 과정이다.
	- 파싱 -> 토큰 -> DOM/CSSOM -> 렌더 트리 -> 레이아웃 -> 페인트 -> 합성
	- #DOMTREE구성과정 참조
- 파싱을 차단하는 HTTP 요청: 브라우저는 HTML 문서를 파싱하다가 CSS, JS, 이미지 등의 리소스를 다운로드하기 위해 추가적인 HTTP 요청을 보낸다.

### script 태그의 렌더링 영향도

- script 태그는 브라우저가 HTML을 파싱하는 도중에 `script` 태그를 만나면 HTML 파싱을 중단하고 script를 다운로드하고 실행한다.
- 파싱을 멈추는 이유는 HTML 문서에 사용할 `script` 태그의 컨텐츠를 다운로드하기 위해서 HTTP 요청을 만들고 응답을 기다리기 때문이다.
- 브라우저는 파싱과 HTTP요청을 하나의 메인스레드에서 처리하기 때문에 script 태그로 블로킹된다.
- 브라우저는 메인 쓰레드뿐 아니라 다른 쓰레드(백그라운드 쓰레드)를 사용해 비동기적으로 리소스를 다운로드하고 실행할 수 있다.
- 그중에 IO(Input/Output) 쓰레드는 네트워크 요청, 파일의 입출력, 다른 외부 자원관 통신을 처리한다.
	- HTTP과 같은 네트워크 작업을 위 쓰레드에서 처리 할 수 있다.
	- 브라우저는 `script` 파싱 중 `async`, `defer` 속성을 만나면 script를 다운로드을 위 쓰레드로 넘긴다. 
#### script 태그 위치

- script 태그는 body 태그의 가장 아래에 위치하는 것이 좋다.
- script 태그가 body 태그의 가장 아래에 위치하면 HTML 파싱이 끝난 후 script를 다운로드하고 실행하기 때문에 페이지 렌더링이 빨라진다.
- script 태그가 head 태그에 위치하면 HTML 파싱을 중단하고 script를 다운로드하고 실행하기 때문에 페이지 렌더링이 지연된다.

#### script 태그의 async와 defer 속성

- async
	- 파싱과 동시에 파일을 다운로드 한다.
	- 다운로드 완료한 순서대로 실행한다.
	- 다운로드가 완료되지 않아도 다음 HTML 파싱을 진행한다.
		- 다운로드가 완료되면 실행한다.
	- DOM에 무관하거나 서로 영향을 주지 않는 스크립트에 적합한다.
		- 실행 순서를 보장하지 않기때문이다.
		- 광고, 분석 트래커 등
- defer
	- 파싱을 중단하지 않고 파일을 다운로드한다.
		- 미리 다운로드한 뒤 실행 순서를 보장한다.
	- HTML 파싱이 끝나면 다운로드한 순서대로 실행한다.
		- 서로 의존하는 스크립트에 적합하다.

#### Preload

- 웹문서에 필요한 자원을 미리 다운로드하는 방법
- 용량이 큰 이미지를 다운로드 하는 상황
- 이미지, 비디오, 스타일시트, 폰트, 자바스크립트 등에 활용
- 미리 다운로드 할 어떠한 자원에도 사용가능하다.
- 참조 https://developer.mozilla.org/ko/docs/Web/HTML/Attributes/rel/preload

[`<link>`](https://developer.mozilla.org/ko/docs/Web/HTML/Element/link) 요소의 [`rel`](https://developer.mozilla.org/ko/docs/Web/HTML/Element/link#rel) 특성의 `preload` 값은 HTML의 [`<head>`](https://developer.mozilla.org/ko/docs/Web/HTML/Element/head)에서 가져오기 요청을 선언할 수 있게 해주며, 페이지에서 즉시 필요로 하는 리소스를 명시하여 CRP(Critical Rendering Path) 절차가 개입하기 전에 리소스를 가져오도록 할 수 있다.

- 해당 파일이 필요할때 즉시 사용할 수 있도록 프리로드가 가능하다.
- 리소스가 늦게 발견되거나 크기가 클수록 프리로드의 이점은 더욱더 명확해진다.

`as`를 이용해 특정한 유형의 컨텐츠를 프리로드 하도록 지정하면 브라우저는 다음과 같은 작업을 한다.
- 리소스의 우선순위를 더욱 정확하게 지정할 수 있다.
- 캐시에 리소스를 저장하여 추후 요청에 적절하게 재사용할 수 있다.
- 리소스에 대해 올바른 [콘텐츠 보안 정책](https://developer.mozilla.org/ko/docs/Web/HTTP/CSP)을 적용할 수 있다.
- 리소스에 대해 올바른 [`Accept`](https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Accept) 요청 헤더를 설정할 수 있다.

#### Prefetch

브라우저는 현재 문서 렌더링에 필요한 모든 작업을 처리하고 나서 남는 시간(유효 시간)에 프리패치로 설정한 파일을 다운로드한다.

- 다음 페이지에서 사용할 자원을 미리 다운로드 하는 방법
- 용량이 큰 다음 페이지로 이동하는 상황
- 링크 이동과 동시에 페이지가 렌더링되도록 개선
- 다음 문서의 렌더링 성능을 높일때 활용

#### 이미지 지연 로딩

이미지 태그는 문서를 로딩하는 시간을 지연시킬수 있다.한 문서에 많은 이미지가 있으면 개수만큼 브라우저가 HTTP 요청을 만들고 서버에 응답을 기다려야 한다.이미지를 지연 로딩하면 페이지 로딩 시간을 단축할 수 있다.

- 브라우저가 img 태그의 이미지를 다운로드하는 시점
- 뷰 포트 안에 이미지만 다운로드하고 밖에 있는 이미지는 지연 로딩한다.
- 이미지가 많은 사진첩이나 블로그에서 활용


