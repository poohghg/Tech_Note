### 불변성(Immutable)이란?

> 한 번 생성된 데이터(값)는 변경되지 않는다는 것을 의미한다. 즉 불변성은 데이터가 생성된 이후 변경할 수 없는 상태를 의미한다.
> 
> 즉, 어떤 값을 변경하려 할 때 기존값을 직접 변경하는 것이 아니라, 새로운 값을 복사해서 수정한 다음 새로운 값을 반환하는 방식을 의미한다.
 
보통 불변성의 의미는 **상태를 변경**하지 않는 것 이라는 간단한 정의로 설명 될 수도 있다.
- 함수 외부 변수의 값을 변경하면 안된다.
- 함수의 인자를 변경하면 안된다.
- 변할 수 없는 변경 될 수 없는 성질이다. 즉 상태를 변경하지 않는 것. 

불변성에서 말하는 상태의 변경이란 프로그램의 변수를 변경하거나 재할달 하지 않는 것 이상의 의미를 가진다.
정확히 말하면 **메모리에 저장된 값**을 변경하는 모든 행위를 의미하며, 여기에 변수의 재할당과 같은 행위도 포함되는 것이다.

### 불변성을 지키는 이유

1. 예측  가능한 코드 작성
	- 값이 바뀌는 일이 없기 때문에, 디버깅이 쉽다.
	- 데이트 흐름 추적이 용이하다.
2.  참조  변경 감지가 쉬움
	- 객체의 참조가 변경되면, 이전 객체와 새로운 객체를 쉽게 비교할 수 있다.

### 메모리 구조

- 스택 메모리: 정적 메모리 할당. 원시 타입 값, 변수, 함수의 실행 정보등이 저장된다. 데이터 크기가 고정되어 있고, 빠르고 효율적으로 접근할 수 있다.
	- 스택 메모리는 함수의 호출과 반환에 따라 자동으로 할당되고 해제된다.
	- 스택 메모리는 LIFO(Last In First Out) 구조로 동작한다.
	- 스택 메모리는 함수의 지역 변수와 매개변수, 리턴 주소 등을 저장하는 데 사용된다.
	- 스택 메모리는 메모리의 크기가 제한되어 있어, 너무 많은 데이터를 저장하면 스택 오버플로우가 발생할 수 있다.
- 힙 메모리: 동적 메모리 할당. 참조 타입 값(배열,객체)이 저장된다. 데이터 크기가 정해져 있지 않고, 프로그램 실행 중에 크기가 변할 수 있다. 스택 보다 접근 속도가 느리다.
	- 힙 메모리는 런타임에 동적으로 할당되고 해제된다.
	- 힙 메모리는 메모리의 크기가 제한되어 있지 않아, 큰 데이터를 저장할 수 있다.
	- 힙 메모리는 가비지 컬렉션(Garbage Collection)으로 자동으로 메모리를 관리한다.
### 원시 타입과 참조 타입

원시 타입과 참조 타입은 메모리 참조방식이 다르다. 원시 타입이 메모리에 할당될 때는 값 자체를 저장하고 참조 타입이 메모리에 할당될 때는 **힙 메모리에 영역에 저장된 값을 가르키는 메모리 주소**를 저장한다. 

### 값의 의한 호출 방식(원시 타입)

값의 의한 호출 방식은 함수의 인자로 어떤 변수를 넘길때 해당 변수가 가지고 있는 값을 그대로 복사하여 함수에게 넘겨주는 방식을 의미한다. 함수에 넘기는 변수가 가리키는 값을 넘기는 것이 아니라 그 값을 복사하여 새로운 메모리 공간에 저장하고 넘겨준다는 것을 의미한다.
즉 **값의 의한 호출 방식은 메모리에 이미 담겨있는 값을 변경하지 않아 불변성**을 지킨다.

- 변수의 값을 변경하면 기존 메모리 영역에 값이 변경되는 것이 아니라 새로운 메모리에 할당하여 그 주소를 바라보게 변경한다.

![Pasted image 20250402171941.png](../img/Pasted%20image%2020250402171941.png)

![Pasted image 20241028163849.png](../img/Pasted%20image%2020241028163849.png)

### 참조에 의한 호출(레퍼런스 타입)

![Pasted image 20250402171914.png](../img/Pasted%20image%2020250402171914.png)

참조의 의한 호출은 레퍼런스 타입인 객체타입을 함수의 인자로 전달할때 발생한다. 해당 호출 방식은 변수가 가르키고 있는 메모리 공간의 주소를 넘기는 방식이다. 이때 만약 함수가 해당 변수를 변경한다면 원본 변수에 저장된 데이터도 변화하게 된다.(메모리 공간에 접근할 수 있는 변수명만 다를뿐, 실제로는 같은 메모리 공간에 저장되어 있다.)

즉 참조에 의한 호출의 경우 별다른 처리가 없다면 불변성이 깨질 수 있다.

![Pasted image 20241028164635.png](../img/Pasted%20image%2020241028164635.png)


> 이런 원리는 웹 프론트엔드의 UI 라이브러리인 `리액트(React)`에서 상태의 변화를 감지하는 데에도 사용되고 있는데, 리액트는 개발자가 `setState`와 같은 메소드를 사용하여 상태를 변경했을 때 `Object.is` 메소드를 사용하여 이전 상태와 다음 상태를 비교하고 두 객체가 같지 않다고 평가되면 상태가 변이되었다고 판단하고 컴포넌트를 다시 렌더한다.
> 
> 출처 
>  https://evan-moon.github.io/2020/01/05/what-is-immutable/