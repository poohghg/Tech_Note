> 바벨과 폴리필은 최신 자바스크립트(ES6+) 기능을 구현 브라우저에서 동작하게 하려는 도구지만, 역할과 방식은 완전히 다르다.

|구분|Babel (트랜스파일러)|Polyfill (런타임 보완 코드)|
|---|---|---|
|목적|최신 문법을 **낡은 문법으로 변환**|최신 API를 **구형 환경에서도 사용 가능하게**|
|동작 시점|**빌드 타임(개발 중)**|**런타임(실행 중)**|
|예시|`class`, `arrow function` 등 문법 변환|`Promise`, `fetch`, `Array.prototype.includes` 등 추가|
|구성 방식|문법 단위로 **코드를 변경**|**기능이 없는 경우**, JS로 구현된 **대체 함수** 제공|
|한계|문법만 바꾸므로, **API 자체는 대체 못함**|문법은 못 바꾸고, **환경 기능만 보완함**|
### Babel: 문법 변환기 (트랜스파일러)

> 최신 자바스크립트 문법을 예전 문법으로 바꿔주는 도구이다.

``` js
// 최신 문법
const add = (a, b) => a + b;
class Person {
  constructor(name) {
    this.name = name;
  }
}

// Babel이 바꾸면
var add = function (a, b) {
  return a + b;
};
function Person(name) {
  this.name = name;
}

```

- 바벨은 ES6+ 문법 -> ES5 문법으로 바꿔서 브라우저가 이해할 수 있게 만든다.
- 문법 수준에서 해결하므로, 브라우저에 따라 다른 API는 처리하지 못한다.

``` js
Promise.resolve("hi"); // Promise는 문법이 아니라 전역 API임

```

### Polyfill: 기능 보완 코드

> 브라우저에는 없는 기능(API)을 자바스크립트 코드로 대채 구현해준다.

``` js
// 옛날 브라우저는 Promise 없음
if (!window.Promise) {
  window.Promise = function (executor) {
    // 폴리필된 Promise 구현체
  };
}

```

- 브라우저에 해당 기능이 없으면, 기 기능을 흉내낸 JS 구현체를 삽입한다.
- 보통 `core-js`, `whatwg-fetch`, `regenerator-runtime` 같은 라이브러리를 통해 제공됨

### Babel + Polyfill 함께 쓰는 이유

> 최신 자바스크립트 문법과 API를 모두 지원하기 위해 Babel과 Polyfill을 함께 사용한다.
> Babel은 문법 변환을, Polyfill은 API 보완을 담당한다.

``` js
async function getData() {
  const res = await fetch("/api/data");
  return res.json();
}
```

|문법 또는 API|누가 처리해줌|
|---|---|
|`async/await`|Babel (→ Promise 기반 코드로 변환)|
|`fetch`|Polyfill (`whatwg-fetch`)|
|`Promise`|Polyfill (`core-js`)|

###  추가 정보 

- Babel은 `@babel/preset-env`와 함께 설정하면 **브라우저 지원 범위에 맞게 변환 + 필요한 polyfill 자동 삽입** 가능
- `core-js`와 `regenerator-runtime`는 그 폴리필의 핵심
- `useBuiltIns: 'usage'`로 설정하면, 실제 사용한 API만 폴리필됨

``` js
// babel.config.js
module.exports = {
  presets: [
    ["@babel/preset-env", {
      useBuiltIns: "usage",  // 사용한 기능만 polyfill
      corejs: { "version": 3, "proposals": true }
      targets: {
        browsers: [
          "last 2 versions", // 최신 2개 버전 브라우저
          "not dead",        // 지원 종료된 브라우저 제외
          "not < 0.5%"     // 점유율 0.5% 미만 브라우저 제외
        ]
      }
    }]
  ]
}

```

- useBuiltIns: 코드에서 사용된 API 중 `targets`에 명시된 브라우저에 없는 기능만 감지하여 필요한 폴리필을 자동으로 `import` 합니다. (가장 효율적)

#### Next.js와 같은 프레임워크

- **`package.json`에 추가**

```  
  "browserslist": [
    "> 0.5%",
    "not dead",
    "not ie 11"
  ]
```

이렇게만 설정하면, Next.js는 빌드 시 이 목록에 포함된 브라우저들을 기준으로 필요한 폴리필만 자동으로 번들에 포함시킨다. 예를 들어, `Array.prototype.flat`을 지원하지 않는 브라우저가 목록에 있다면, 해당 폴리필이 자동으로 추가
### 브라우저에서 실행되는 순서

1. 사용자가 웹사이트 접속
2. 브라우저가 `<script src="bundle.js">`를 로드
3. 번들 파일 맨 위에서 `core-js/modules/es.array.includes.js`가 먼저 실행됨
4. 이때 `Array.prototype.includes`가 있는지 체크하고 없으면 직접 추가
5. 그 다음 사용자 코드 (`[1,2,3].includes(2)`)가 실행됨
6. 브라우저가 `includes`를 호출하면, **core-js가 만든 그 함수가 호출됨**

### 참고 사이트
https://toss.tech/article/smart-polyfills